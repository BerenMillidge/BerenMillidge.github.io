<!DOCTYPE html>
<html lang="en">
  <head>
    
<link rel="stylesheet" type="text/css" href="/iodide.css">
<base target="_blank" rel="noopener noreferrer">

    <link rel="apple-touch-icon" sizes="180x180" href="https://alpha.iodide.io/assets/apple-touch-icon.59292ba7e7ef.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://alpha.iodide.io/assets/favicon-32x32.b83ba6c1e89c.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://alpha.iodide.io/assets/favicon-16x16.f81a0b8af468.png">
    <link rel="icon" type="image/x-icon" href="https://alpha.iodide.io/assets/favicon.8e5f6b92e09f.ico">
    <link rel="mask-icon" href="https://alpha.iodide.io/assets/safari-pinned-tab.58984d7e2126.svg" color="#5bbad5">
    <!-- meta-properties for Facebook, Slack, and other social media -->
		<meta property="og:title" content="The Lorenz Attractor">
		<meta property="og:description" content="Iodide notebook">
		<meta property="og:image" content="https://alpha.iodide.io/assets/apple-touch-icon.59292ba7e7ef.png">
		<meta property="og:url" content="https://alpha.iodide.io/">
		<!-- twitter-specific metadata properties -->
		<meta name="twitter:title" content="The Lorenz Attractor">
		<meta name="twitter:description" content="Iodide notebook">
		<meta name="twitter:image" content="https://alpha.iodide.io/assets/apple-touch-icon.59292ba7e7ef.png">
		<meta name="twitter:card" content="summary">
    <title>The Lorenz Attractor</title>
  </head>
  <body>
    
<div id="notebook-header"></div>
<div id="editor-react-root"></div>
<script id="iomd" type="text/iomd">%% md
# The Lorenz Attractor in Iodide

This notebook is inspired by the [demo notebook](https://mybinder.org/v2/gh/jupyterlab/jupyterlab-demo/18a9793b58ba86660b5ab964e1aeaf7324d667c8?urlpath=lab%2Ftree%2Fdemo%2FLorenz.ipynb) featured at the top of the [&quot;JupyterLab is ready for users&quot;](https://blog.jupyter.org/jupyterlab-is-ready-for-users-5a6f039b8906) announcement on the [Jupyter blog](https://blog.jupyter.org/).

Having access to browser APIs and live computation alongside an analysis opens up a few opportunities when it comes to telling certain [computational narratives](https://blog.jupyter.org/project-jupyter-computational-narratives-as-the-engine-of-collaborative-data-science-2b5fb94c3c58). In this case the browser gives us richer real-time interactivity and much greater responsiveness than is typically possible with a remotely hosted kernel, and access to the media APIs offered by the web platform (particularly WebGL) allow us to create 3d graphics that are highly portable.

%% js
// this is a hack to allow the ode45-cash-karp lib to import as expected.
// need to browserify this module.
module = {}

%% fetch
js: https://cdn.jsdelivr.net/npm/ode45-cash-karp@1.1.0/lib/index.min.js
js: https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.36.1/plotly.min.js
js: https://d3js.org/d3.v5.min.js
js: https://code.jquery.com/jquery-1.12.4.js
%% js
ode45 = module.exports

%% js
function integrateLorenz(t0, tmax, dt0, S0, sigma, beta, rho) {
  const lorenzSystem = function(dSdt, S, t) {
    const [x,y,z] = S
    dSdt[0] = sigma*(y-x)
    dSdt[1] = x*(rho-z) - y
    dSdt[2] = x*y - beta*z
  }
  const integrator = ode45( S0.slice(), lorenzSystem, t0, dt0 )
  // Integrate up to tmax:
  const t = [], S = []
  while( integrator.step( tmax ) ) {
  // while( t.length &lt; 2000 ) {
    // Store the solution at this timestep:
    // integrator.step()
    t.push( integrator.t )
    S.push( integrator.y.slice() )
  }
  return [S,t]
}

%% js
sigma = 10
beta = 2.67
rho = 28

var t0 = 0, tmax = 4, dt0 = 1e-3
S0random = () =&gt; [50*(Math.random()-.5), 50*(Math.random()-.5), 40*Math.random()+10]
var S0 = S0random()

var numTraces = 10
tracesS0 = []
traceData = []
traces = []
for (let i=0; i&lt;numTraces; i++){
  tracesS0.push(S0random())
  traceData.push(integrateLorenz(t0, tmax, dt0, tracesS0[i].slice(), sigma, beta, rho))
  traces.push({
    type: &#x27;scatter3d&#x27;,
    mode: &#x27;lines&#x27;,
    x: traceData[i][0].map(s =&gt; s[0]),
    y: traceData[i][0].map(s =&gt; s[1]),
    z: traceData[i][0].map(s =&gt; s[2]),
    // opacity: .5,
    name: &quot;line-&quot;+i,
    line: {width: 4, color: d3.interpolateRainbow(i/numTraces)}
    })
}

%% js
function initPlot(targetDiv){
  targetDiv.innerHTML = &#x27;&#x27;
  Plotly.newPlot(
    targetDiv,
    traces,
    {
      showlegend: false,
      height: 550,
      width: 800,
      autosize: false,
      scene:{
        xaxis: {range: [-30, 30], autorange: false, tickmode: &#x27;linear&#x27;, tick0: 0, dtick: 5},
        yaxis: {range: [-30, 30], autorange: false, tickmode: &#x27;linear&#x27;, tick0: 0, dtick: 5},
        zaxis: {range: [0, 70], autorange: false, tickmode: &#x27;linear&#x27;, tick0: 0, dtick: 5},
        aspectratio: {x: 1, y: 1, z: 1}
      },
      margin: { l: 0, r: 0, b: 0, t: 0, pad: 0},
    }            
  )
}

%% js
function updateTraces(tracesS0, sigma, beta, rho){
  const traceUpdates = []
  for (let i=0; i&lt;numTraces; i++){
    traceUpdates.push(integrateLorenz(t0, tmax, dt0, tracesS0[i].slice(), sigma, beta, rho))
  }
  var data_update = {
      x: traceUpdates.map(tr =&gt; tr[0].map(s =&gt; s[0])),
      y: traceUpdates.map(tr =&gt; tr[0].map(s =&gt; s[1])),
      z: traceUpdates.map(tr =&gt; tr[0].map(s =&gt; s[2])),
      }
  Plotly.restyle(&#x27;lorenz-graph&#x27;, data_update)
}

%% js
// jQuery is out of fashion for building gigantic web apps, but it&#x27;s extremely well-documented 
// and quite well-suited for doing interactive manipulations of the DOM in smaller code bases,
// like an Iodide notebook.

// In the future, we may wrap this functionality into a &quot;widgets&quot; section of our standard lib,
// but because we&#x27;re close to the DOM and there are already so many libs that do this, it&#x27;s not
// a pressing need.

function initControls(){ 
  props = {
    sigma: {min:0, max:50, value:10, step: .01},
    beta: {min:-2, max:10, value:2.67, step: .01},
    rho: {min:0, max:50, value:28, step: .01},
  }

  $(&quot;#lorenz-controls&quot;).empty();
  // set up sliders
  [&quot;sigma&quot;,&quot;beta&quot;,&quot;rho&quot;].forEach( (param) =&gt; {
    controlDiv = $(`&lt;div&gt;&lt;input id=&quot;${param}-slider&quot; type=&quot;range&quot; step=&quot;0.01&quot;&gt;&lt;/input&gt;
${param} (&lt;span id=&quot;${param}-val&quot;&gt;${props[param].value}&lt;/span&gt;)&lt;div&gt;`)
    $(&quot;#lorenz-controls&quot;).append(controlDiv)
    
    const thisSlider = $(`#${param}-slider`)
    thisSlider.prop(props[param])   
    thisSlider.on(&quot;input&quot;, () =&gt; {
      const [sigma, beta, rho] = getUiParamVals()
      updateTraces(tracesS0, sigma, beta, rho)
      setUiParamVals({sigma, beta, rho})
    })      
  })
  
  // set up reset button
  const buttonDiv = $(&#x27;&lt;div&gt;&lt;input id=&quot;reset-button&quot; type=&quot;button&quot; value=&quot;Reset parameters&quot;&gt;&lt;/div&gt;)&#x27;)
  $(&quot;#lorenz-controls&quot;).append(buttonDiv)
  $(&quot;#reset-button&quot;).on(&quot;click&quot;, () =&gt; {
    const [sigma,beta,rho] = [10, 2.67, 28]
    setUiParamVals({sigma, beta, rho})
    setSliderVals({sigma, beta, rho})
    updateTraces(tracesS0, sigma, beta, rho)
  })
}

function getUiParamVals(){
  return [&quot;sigma&quot;,&quot;beta&quot;,&quot;rho&quot;].map( param =&gt; 
    $(`#${param}-slider`).prop(&quot;value&quot;)
  )
}
  
function setUiParamVals(paramObj){
  [&quot;sigma&quot;,&quot;beta&quot;,&quot;rho&quot;].forEach( param =&gt; $(`#${param}-val`).html(paramObj[param]) )
}

function setSliderVals(paramObj){
  [&quot;sigma&quot;,&quot;beta&quot;,&quot;rho&quot;].forEach( param =&gt; $(`#${param}-slider`).prop(&quot;value&quot;, paramObj[param]) )
}

%% md
### The Lorenz system

Let&#x27;s explore the Lorenz system of differential equations:

$$
\begin{aligned}
\dot{x} &amp; = \sigma(y-x) \\
\dot{y} &amp; = \rho x - y - xz \\
\dot{z} &amp; = -\beta z + xy
\end{aligned}
$$

Below we plot the evolution of this system for several different randomly chosen initial conditions (the trajectory for each initial condition is shown in a different color). You can rotate, pan, and zoom to gain a better understanding of the three-dimensional structure of the attractor. Additionally, you can adjust the sliders below to change the parameters of the system.

&lt;div id=&quot;lorenz-graph&quot; style=&quot;text-align:center&quot;&gt;
  (loading Plotly graphing lib)
  &lt;/br&gt;&lt;/br&gt;
  &lt;img src=&quot;https://cdnjs.cloudflare.com/ajax/libs/galleriffic/2.0.1/css/loader.gif&quot;&gt;&lt;/img&gt;
&lt;/div&gt;

&lt;div id=&quot;lorenz-controls&quot;&gt; &lt;/div&gt;

%% js
initPlot(document.getElementById(&#x27;lorenz-graph&#x27;))
initControls()

%% css
/* let&#x27;s add a fine border around the plot canvas to make it clearer when the plot gets cut off at the edge of the canvas*/
canvas { border: 1px solid #eee }

%% js</script>
<iframe
  id="eval-frame"
  src="https://alpha.iodide.app/notebooks/eval-frame/"
  sandbox="allow-scripts allow-same-origin allow-modals allow-popups"
  allowfullscreen="true"
  allowvr="yes"
  allow="microphone"
></iframe>
<script id="userData" type="application/json">{"name": "Bmillidgework", "avatar": "https://avatars2.githubusercontent.com/u/20473757?v=4"}</script>
<script id="notebookInfo" type="application/json">{"username": "bcolloran", "user_can_save": false, "notebook_id": 34, "revision_id": 41463, "revision_is_latest": true, "connectionMode": "SERVER", "title": "The Lorenz Attractor", "max_filename_length": 120, "max_file_size": 10485760, "forked_from": false}</script>
<script>
  window.evalFrameOrigin = "https://alpha.iodide.app/";
</script>
<script src="/iodide.js"></script>

    <script>
  // detecting "do not track" via these instructions:
  // https://dev.to/corbindavenport/how-to-correctly-check-for-do-not-track-with-javascript-135d
  if (window.doNotTrack == "1" ||
      navigator.doNotTrack == "yes" || navigator.doNotTrack == "1" ||
      navigator.msDoNotTrack == "1" ||
      ('msTrackingProtectionEnabled' in window.external &&
       window.external.msTrackingProtectionEnabled())) {
    // do not track is enabled: disable per google's instructions:
    // https://developers.google.com/analytics/devguides/collection/gtagjs/user-opt-out
    window['ga-disable-UA-1648932-8'] = true;
  }
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1648932-8"></script>
<script>
  if (!window['ga-disable-UA-1648932-8']) {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-1648932-8');
  } else {
    console.log('Do not track enabled, google analytics disabled')
  }
</script>

  </body>
</html>
